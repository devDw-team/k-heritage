# 작업 일지: Flutter UI 화면 개발

**작업일**: 2025-01-19  
**작업자**: Claude  
**프로젝트**: K-Heritage Explorer (포켓 문화재 가이드)

## 📋 작업 개요

HTML 디자인 프로토타입을 기반으로 Flutter UI 화면을 개발하고, 하단 네비게이션 바를 추가하여 사용자 경험을 개선했습니다.

## 🎯 작업 목표

1. 디자인 프로토타입에 맞는 Flutter 화면 구현
2. 한국 전통색을 활용한 테마 시스템 구축
3. 하단 네비게이션을 통한 화면 전환 구조 구현
4. Clean Architecture 기반 폴더 구조 적용

## ✅ 완료된 작업

### 1단계: 핵심 설정 및 테마 구성

#### 색상 시스템 (`app_colors.dart`)
- **한국 전통색 팔레트 정의**
  - 단청 적색 (#D03A29): 주요 액션, 마커
  - 청자 녹색 (#7BA098): 성공 상태, 토글
  - 오방색 청색 (#2B4C8C): 선택 상태, 링크
  - 한지 베이지 (#F5E6D3): 배경, 카드
  - 먹색 (#1A1A1A): 텍스트
  - 백자 흰색 (#FAFAFA): 표면

#### 타이포그래피 (`app_typography.dart`)
- **폰트 시스템 구성**
  - Noto Serif KR: 제목, 문화재 이름 (전통적 느낌)
  - Noto Sans KR: 본문, 설명 (가독성)
  - Inter: 숫자, 거리 표시 (명확성)

#### 테마 설정 (`app_theme.dart`)
- Material 3 디자인 시스템 적용
- Light/Dark 테마 지원
- 간격, 둥근 모서리, 그림자 상수 정의

#### 라우팅 설정 (`app_router.dart`)
- go_router를 사용한 네비게이션 구성
- ShellRoute로 하단 네비게이션 구현
- 딥링크 지원 구조

#### 하단 네비게이션 (`main_scaffold.dart`)
- 4개 탭: 홈, 테마, 북마크, 설정
- Material 3 NavigationBar 사용
- 탭별 상태 유지

### 2단계: 도메인 모델 및 상태 관리

#### Freezed 모델 (`heritage.dart`)
```dart
- Heritage: 문화재 정보
- HeritageImage: 문화재 이미지
- Theme: 테마 정보
- UserSettings: 사용자 설정
- HeritageCategory: 문화재 분류 enum
```

### 3단계: 화면 구현

#### 1. 언어 선택 화면 (`language_selection_screen.dart`)
**특징**:
- 4개 언어 지원 (한국어, English, 中文, 日本語)
- 애니메이션 진입 효과 (Staggered Animation)
- 그라데이션 배경과 전통 문양 장식
- 선택된 언어에 따른 버튼 텍스트 변경

**구현 내용**:
- AnimationController를 사용한 카드 애니메이션
- 언어별 고유 색상과 아이콘
- 선택 상태 시각적 피드백

#### 2. 홈 화면 (`home_screen.dart`)
**특징**:
- Google Maps 통합
- DraggableScrollableSheet로 하단 시트 구현
- 카테고리 필터 칩
- 문화재 카드 리스트
- 현재 위치 FAB

**구현 내용**:
- 지도 마커 클러스터링 준비
- 3단계 스냅 포인트 (0.1, 0.3, 0.9)
- 카테고리별 필터링 로직
- 마커 탭 시 하단 시트 확장

#### 3. 문화재 상세 화면 (`detail_screen.dart`)
**특징**:
- SliverAppBar와 이미지 캐러셀
- 페이지 인디케이터
- 상세 정보 섹션
- 길찾기 & 오디오 가이드 버튼
- 북마크 토글

**구현 내용**:
- PageView를 사용한 이미지 갤러리
- url_launcher를 통한 지도 앱 연동
- 관람 정보 카드
- 메타 정보 표시 위젯

#### 4. 테마 탐방 화면 (`theme_screen.dart`)
**특징**:
- 6개 테마 카드 그리드
- 테마별 아이콘과 색상
- 이달의 추천 코스 섹션

**구현 내용**:
- GridView를 사용한 카드 레이아웃
- 테마별 문화재 개수 표시
- InkWell 터치 피드백

#### 5. 북마크 화면 (`bookmarks_screen.dart`)
**특징**:
- 저장된 문화재 리스트
- 빈 상태 UI
- HeritageCard 위젯 재사용

**구현 내용**:
- 북마크 상태 관리 준비
- 빈 상태 일러스트레이션
- 거리 표시 옵션 제거

#### 6. 설정 화면 (`settings_screen.dart`)
**특징**:
- 언어 설정 선택기
- 탐색 반경 슬라이더 (1-10km)
- 알림 설정 스위치
- 앱 정보 섹션

**구현 내용**:
- 섹션별 그룹화
- 커스텀 슬라이더 테마
- 언어 선택 칩
- ListTile 기반 설정 항목

### 공통 위젯

#### HeritageCard (`heritage_card.dart`)
- 문화재 카드 컴포넌트
- 이미지, 제목, 카테고리, 거리 표시
- 카테고리별 색상 적용
- CachedNetworkImage 사용

#### CategoryChip (`category_chip.dart`)
- 카테고리 필터 칩
- 선택 상태 애니메이션
- 터치 피드백

## 📁 폴더 구조

```
lib/
├── app/
│   ├── router/
│   │   └── app_router.dart
│   └── theme/
│       ├── app_colors.dart
│       ├── app_typography.dart
│       └── app_theme.dart
├── features/
│   ├── common/
│   │   └── widgets/
│   │       └── main_scaffold.dart
│   ├── onboarding/
│   │   └── presentation/
│   │       └── screens/
│   │           └── language_selection_screen.dart
│   ├── heritage/
│   │   ├── domain/
│   │   │   └── entities/
│   │   │       └── heritage.dart
│   │   └── presentation/
│   │       ├── screens/
│   │       │   ├── home_screen.dart
│   │       │   ├── detail_screen.dart
│   │       │   └── theme_screen.dart
│   │       └── widgets/
│   │           ├── heritage_card.dart
│   │           └── category_chip.dart
│   ├── bookmarks/
│   │   └── presentation/
│   │       └── screens/
│   │           └── bookmarks_screen.dart
│   └── settings/
│       └── presentation/
│           └── screens/
│               └── settings_screen.dart
└── main.dart
```

## 🔧 기술 스택

- **상태 관리**: flutter_riverpod 2.5.1
- **라우팅**: go_router 14.2.0
- **HTTP**: dio 5.4.3
- **데이터 모델**: freezed 2.5.2, json_serializable 6.8.0
- **지도**: google_maps_flutter 2.6.1
- **위치**: geolocator 12.0.0
- **이미지 캐싱**: cached_network_image 3.3.1
- **백엔드**: supabase_flutter 2.5.9
- **URL 처리**: url_launcher 6.2.5

## 🐛 버그 수정 및 개선 사항 (2025-01-19 추가)

### iOS 빌드 오류 해결

#### 1. iOS 최소 버전 업데이트 (12.0 → 14.0)
**문제**: google_maps_flutter_ios 패키지가 iOS 14.0 이상 요구
**해결**:
- `ios/Podfile`: platform :ios, '14.0'
- `ios/Runner.xcodeproj/project.pbxproj`: IPHONEOS_DEPLOYMENT_TARGET = 14.0
- `ios/Flutter/AppFrameworkInfo.plist`: MinimumOSVersion = 14.0

#### 2. Flutter 3.x 테마 호환성 문제
**문제**: CardTheme과 DialogTheme 타입 불일치
**해결**: 
- `app_theme.dart`에서 CardTheme과 DialogTheme 섹션 주석 처리
- Flutter 3.x API 변경사항에 따른 수정

#### 3. 폰트 설정 완료
**작업 내용**:
- `pubspec.yaml` 폰트 설정 활성화
- NotoSansKR, NotoSerifKR, Inter 폰트 적용
- 실제 폰트 파일명에 맞게 경로 수정

#### 4. Google Maps API 키 설정
**iOS (AppDelegate.swift)**:
```swift
import GoogleMaps
GMSServices.provideAPIKey("YOUR_API_KEY")
```

**Android (AndroidManifest.xml)**:
```xml
<meta-data
    android:name="com.google.android.geo.API_KEY"
    android:value="YOUR_API_KEY"/>
```

#### 5. 앱 크래시 방지 처리
**HomeScreen 개선**:
- GoogleMapController를 nullable로 변경
- Google Maps 초기화 실패 시 플레이스홀더 표시
- try-catch로 에러 처리 추가
- API 키 없어도 앱이 실행되도록 개선

### Google Translate API 설정 가이드 추가
**문서 생성**: `doc/GOOGLE_TRANSLATE_SETUP.md`
- Google Cloud Console 프로젝트 생성 방법
- Translation API 활성화 절차
- API 키 생성 및 보안 설정
- Supabase Edge Function 프록시 구현 예제
- 요금 정보 및 비용 절감 방법
- 대안 번역 서비스 비교 (DeepL, Papago, Azure, AWS)

## 📝 추가 필요 작업

### 즉시 필요
1. ~~**폰트 파일 추가**~~ ✅ 완료
   - ~~assets/fonts/ 폴더에 Noto 폰트 다운로드~~
   - ~~Google Fonts에서 다운로드 가능~~

2. ~~**Google Maps API 키 설정**~~ ✅ 구조 완료 (실제 키 입력 필요)
   - ~~Android: AndroidManifest.xml~~
   - ~~iOS: AppDelegate.swift~~
   - ⚠️ 실제 API 키로 교체 필요

3. **환경 변수 설정**
   - .env 파일 생성
   - Supabase URL, API 키 추가
   - Google Translate API 키 추가

### 향후 개발
1. **백엔드 연동**
   - Supabase 테이블 생성
   - Repository 구현
   - 실제 API 연결

2. **기능 구현**
   - 위치 권한 처리
   - 실시간 위치 추적
   - 오프라인 캐싱
   - 번역 기능

3. **성능 최적화**
   - 이미지 lazy loading
   - 지도 마커 클러스터링
   - 무한 스크롤

4. **다국어 지원**
   - intl 패키지 설정
   - ARB 파일 생성
   - 번역 Edge Function

## 💡 개선 제안

1. **UX 개선**
   - 스켈레톤 로딩 추가
   - Pull to refresh
   - 에러 바운더리
   - 네트워크 상태 표시

2. **접근성**
   - 스크린 리더 지원
   - 고대비 모드
   - 큰 글씨 지원

3. **테스트**
   - Widget 테스트
   - Integration 테스트
   - Golden 테스트

## 🎨 디자인 원칙

1. **한국 전통 미학**
   - 전통색 사용
   - 여백의 미
   - 조화와 균형

2. **현대적 UI**
   - Material 3 가이드라인
   - 부드러운 애니메이션
   - 직관적 인터랙션

3. **사용성**
   - 명확한 정보 계층
   - 일관된 패턴
   - 빠른 응답성

## 📌 참고 사항

- 모든 화면이 기본 구조로 구현됨
- 더미 데이터 사용 중
- 실제 API 연동 필요
- 에러 처리 로직 추가 필요
- 로딩 상태 구현 필요

## 🚀 실행 방법

```bash
# 의존성 설치
flutter pub get

# 코드 생성
flutter pub run build_runner build --delete-conflicting-outputs

# 앱 실행
flutter run
```

---

**작업 완료 시간**: 2025-01-19  
**다음 작업 예정**: 백엔드 연동 및 실제 데이터 통합